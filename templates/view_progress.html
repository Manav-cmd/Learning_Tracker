{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">

  <!-- ================= HEADER ================= -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-1">Learning Progress</h2>
      <p class="text-muted mb-0">
        Track how far youâ€™ve come across topics
      </p>
    </div>

    <a href="{% url 'add_topic' %}" class="btn btn-primary">
      + Add Topic
    </a>
  </div>

  <!-- ================= DASHBOARD ================= -->
  <div class="row g-4 mb-5">

    <!-- CHART CARD -->
    <div class="col-lg-4">
      <div class="tracker-card h-100 text-center">
        <h5 class="fw-bold mb-3">Progress Overview</h5>

        <div style="height: 240px;">
          <canvas id="progressChart"></canvas>
        </div>
      </div>
    </div>

    <!-- TOTAL -->
    <div class="col-lg-2">
      <div class="tracker-card h-100 text-center">
        <h2 class="fw-bold text-success">
          {{ total_topics }}
        </h2>
        <p class="text-muted mb-0">Total Topics</p>
      </div>
    </div>

    <!-- IN PROGRESS -->
    <div class="col-lg-3">
      <div class="tracker-card h-100 text-center">
        <h2 class="fw-bold text-warning">
          {{ in_progress }}
        </h2>
        <p class="text-muted mb-0">In Progress</p>
      </div>
    </div>

    <!-- COMPLETED -->
    <div class="col-lg-3">
      <div class="tracker-card h-100 text-center">
        <h2 class="fw-bold text-primary">
          {{ completed }}
        </h2>
        <p class="text-muted mb-0">Completed</p>
      </div>
    </div>

  </div>

  <!-- ================= TOPIC LIST ================= -->
  <div class="row g-4">
    {% for topic in topics %}
      <div class="col-md-4">
        <div class="tracker-card h-100">

          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h5 class="fw-bold mb-1">{{ topic.title }}</h5>
              <small class="text-muted">{{ topic.subject }}</small>
            </div>

            <span class="badge
              {% if topic.progress == 100 %} bg-success
              {% elif topic.progress > 0 %} bg-warning text-dark
              {% else %} bg-secondary
              {% endif %}
            ">
              {{ topic.status }}
            </span>
          </div>

          <div class="progress mb-2">
            <div
              class="progress-bar"
              style="width: {{ topic.progress }}%">
            </div>
          </div>

          <small class="text-muted">
            {{ topic.progress }}% completed
          </small>

          <div class="mt-3 d-flex gap-2">
            <a
              href="{% url 'update_topic' topic.id %}"
              class="btn btn-outline-primary btn-sm w-100">
              Update
            </a>

            <a
              href="{% url 'delete_topic' topic.id %}"
              class="btn btn-outline-danger btn-sm w-100"
              onclick="return confirm('Delete this topic?')">
              Delete
            </a>
          </div>

        </div>
      </div>
    {% empty %}
      <p class="text-muted">No topics added yet.</p>
    {% endfor %}
  </div>

</div>

<!-- ================= DATA FOR JS (ONLY DATA) ================= -->
<script>
  const completedCount = {{ completed|default:0 }};
  const inProgressCount = {{ in_progress|default:0 }};
  const notStartedCount = {{ not_started|default:0 }};
</script>

{% endblock %}
